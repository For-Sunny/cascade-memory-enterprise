services:
  cascade:
    build: .
    image: cipscorp/cascade-enterprise:latest
    container_name: cascade-memory
    restart: unless-stopped
    stdin_open: true # Keep stdin open for MCP communication
    tty: true        # Allocate a pseudo-TTY
    volumes:
      # Persistent storage for the SQLite database (6 layer files)
      - ./data:/data/cascade
    # RAM disk for sub-millisecond memory acceleration
    # uid/gid=1001 matches the cascade user for write access
    tmpfs:
      - /ram_disk:size=512M,uid=1001,gid=1001,mode=1777
    environment:
      - NODE_ENV=production
      - CASCADE_DB_PATH=/data/cascade
      - CASCADE_RAM_PATH=/ram_disk
    healthcheck:
      test: ["CMD", "node", "server/healthcheck.js"]
      interval: 30s
      timeout: 10s
      start_period: 10s
      retries: 3
    # If you eventually add an HTTP wrapper for remote access:
    # ports:
    #   - "3000:3000"
